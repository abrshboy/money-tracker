
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>CLOUTKEEPER</title>
    
    <!-- PWA / iOS Optimization -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CloutKeeper">
    
    <!-- App Icon (iPhone Home Screen) -->
    <link rel="apple-touch-icon" href="https://imagizer.imageshack.com/img923/6784/tX0q0M.png">
    
    <meta name="theme-color" content="#000000">
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script>
      // Service Worker Registration
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').catch(err => console.log('SW reg failed:', err));
        });
      }

      // Suppress dev console noise
      const originalWarn = console.warn;
      console.warn = (...args) => {
        if (args[0] && typeof args[0] === 'string' && 
           (args[0].includes('cdn.tailwindcss.com') || args[0].includes('in-browser Babel transformer'))) {
          return;
        }
        originalWarn(...args);
      };
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <style>
      :root {
        --sat: env(safe-area-inset-top);
        --sab: env(safe-area-inset-bottom);
      }
      body { 
        font-family: 'Inter', sans-serif; 
        margin: 0; 
        padding: 0; 
        background-color: #000000;
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
        user-select: none;
        overscroll-behavior-y: none;
        color: white;
      }
      .safe-top { padding-top: calc(var(--sat) + 1rem); }
      .safe-bottom { padding-bottom: calc(var(--sab) + 6rem); }
      .nav-safe-bottom { bottom: calc(var(--sab) + 1.5rem); }
      
      @supports (-webkit-touch-callout: none) {
        .min-h-ios { min-height: -webkit-fill-available; }
      }
      
      .pro-motion-transition {
        transition: transform 0.2s cubic-bezier(0.33, 1, 0.68, 1), opacity 0.2s ease;
      }

      ::-webkit-scrollbar { display: none; }
    </style>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
  </head>
  <body>
    <div id="root"></div>
    
    <script type="text/babel" data-presets="react,typescript" data-type="module">
      import React, { useState, useEffect } from 'react';
      import ReactDOM from 'react-dom/client';
      
      const CATEGORIES = ['Food', 'Transport', 'Bills', 'Fun', 'Salary', 'Side Hustle', 'Gift', 'Other'];
      const CATEGORY_COLORS = {
        Food: 'bg-orange-500/10 text-orange-400 border-orange-500/20',
        Transport: 'bg-blue-500/10 text-blue-400 border-blue-500/20',
        Bills: 'bg-purple-500/10 text-purple-400 border-purple-500/20',
        Fun: 'bg-pink-500/10 text-pink-400 border-pink-500/20',
        Salary: 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20',
        'Side Hustle': 'bg-cyan-500/10 text-cyan-400 border-cyan-500/20',
        Gift: 'bg-yellow-500/10 text-yellow-400 border-yellow-500/20',
        Other: 'bg-slate-500/10 text-slate-400 border-slate-500/20',
      };

      const Icons = {
        Food: () => <span>üçï</span>,
        Transport: () => <span>üõπ</span>,
        Bills: () => <span>üí∏</span>,
        Fun: () => <span>üé°</span>,
        Salary: () => <span>üí∞</span>,
        'Side Hustle': () => <span>üöÄ</span>,
        Gift: () => <span>üéÅ</span>,
        Other: () => <span>‚ú®</span>,
        Plus: () => <svg className="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={3}><path d="M12 4v16m8-8H4" /></svg>
      };

      const formatCurrency = (n) => new Intl.NumberFormat('en-ET', { style: 'currency', currency: 'ETB' }).format(n).replace('ETB', 'Br');

      const App = () => {
        const [activeTab, setActiveTab] = useState('dashboard');
        const [isModalOpen, setIsModalOpen] = useState(false);
        const [transactions, setTransactions] = useState([]);
        const [cash, setCash] = useState({ balance: 0, lastUpdated: Date.now() });

        useEffect(() => {
          const t = localStorage.getItem('clout_txs');
          const c = localStorage.getItem('clout_cash');
          if (t) setTransactions(JSON.parse(t));
          if (c) setCash(JSON.parse(c));
        }, []);

        useEffect(() => {
          localStorage.setItem('clout_txs', JSON.stringify(transactions));
          localStorage.setItem('clout_cash', JSON.stringify(cash));
        }, [transactions, cash]);

        const onAddEntry = (data) => {
          const entry = { ...data, id: Date.now(), timestamp: Date.now() };
          setTransactions(prev => [entry, ...prev]);
          if (data.paymentMethod === 'Cash') {
            const mod = data.type === 'Income' ? 1 : -1;
            setCash(prev => ({ balance: prev.balance + (data.amount * mod), lastUpdated: Date.now() }));
          }
          setIsModalOpen(false);
        };

        return (
          <div className="min-h-ios bg-black flex flex-col items-center overflow-x-hidden">
            <header className="w-full max-w-2xl px-6 safe-top pb-4 flex items-center justify-between">
              <div className="flex items-center gap-3">
                 <img 
                    src="https://imagizer.imageshack.com/img923/6784/tX0q0M.png" 
                    className="w-10 h-10 rounded-xl object-cover border border-zinc-800" 
                    alt="Logo" 
                    onError={(e) => e.target.style.display = 'none'}
                 />
                 <h1 className="text-2xl font-black italic tracking-tighter text-white">CLOUT<span className="text-pink-500">KEEPER</span></h1>
              </div>
              <div className="bg-zinc-900/80 px-4 py-1.5 rounded-full border border-zinc-800">
                <span className="text-[10px] font-black uppercase tracking-widest text-zinc-400">PWA NATIVE</span>
              </div>
            </header>

            <main className="w-full max-w-2xl px-6 flex-1 safe-bottom space-y-8 overflow-y-auto">
              {activeTab === 'dashboard' && <Dashboard transactions={transactions} />}
              {activeTab === 'history' && <History transactions={transactions} />}
              {activeTab === 'cash' && <Cash cash={cash} setCash={setCash} />}
            </main>

            <div className="fixed bottom-36 right-6 z-50">
              <button 
                onClick={() => setIsModalOpen(true)}
                className="w-16 h-16 bg-white text-black rounded-full shadow-[0_0_30px_rgba(255,255,255,0.4)] flex items-center justify-center active:scale-90 pro-motion-transition"
              >
                <Icons.Plus />
              </button>
            </div>

            <nav className="fixed nav-safe-bottom left-1/2 -translate-x-1/2 w-[92%] max-w-md bg-zinc-900/60 backdrop-blur-3xl border border-zinc-800/40 rounded-full z-40 px-10 py-5 flex items-center justify-between shadow-2xl">
              <NavBtn active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} icon="üè†" label="Stats" />
              <NavBtn active={activeTab === 'history'} onClick={() => setActiveTab('history')} icon="üßæ" label="Feed" />
              <NavBtn active={activeTab === 'cash'} onClick={() => setActiveTab('cash')} icon="üí∏" label="Cash" />
            </nav>

            {isModalOpen && <AddModal onClose={() => setIsModalOpen(false)} onSubmit={onAddEntry} />}
          </div>
        );
      };

      const NavBtn = ({ active, onClick, icon, label }) => (
        <button onClick={onClick} className={`flex flex-col items-center gap-1 transition-all ${active ? 'text-white scale-110' : 'text-zinc-500'}`}>
          <span className="text-xl">{icon}</span>
          <span className="text-[8px] font-black uppercase tracking-[0.2em]">{label}</span>
        </button>
      );

      const Dashboard = ({ transactions }) => {
        const out = transactions.filter(t => t.type === 'Expense').reduce((s, t) => s + t.amount, 0);
        const inc = transactions.filter(t => t.type === 'Income').reduce((s, t) => s + t.amount, 0);
        return (
          <div className="animate-in fade-in duration-500 space-y-6">
            <div className="bg-zinc-900/50 rounded-[2.5rem] p-8 border border-zinc-800/50 relative overflow-hidden">
              <span className="text-zinc-500 text-[10px] font-black uppercase tracking-[0.3em]">Total Balance</span>
              <h2 className="text-5xl font-black italic tracking-tighter mt-2 text-white">{formatCurrency(inc - out)}</h2>
              <div className="mt-10 grid grid-cols-2 gap-4 border-t border-zinc-800/30 pt-6">
                <div><p className="text-zinc-500 text-[9px] font-black uppercase">Clout In</p><p className="text-emerald-400 font-bold text-lg">{formatCurrency(inc)}</p></div>
                <div><p className="text-zinc-500 text-[9px] font-black uppercase">Clout Out</p><p className="text-pink-500 font-bold text-lg">{formatCurrency(out)}</p></div>
              </div>
            </div>
          </div>
        );
      };

      const History = ({ transactions }) => (
        <div className="space-y-4 animate-in fade-in duration-500 pb-10">
          <h2 className="text-xl font-black italic uppercase tracking-tighter">Digital Receipts</h2>
          {transactions.map(t => (
            <div key={t.id} className="bg-zinc-900/40 p-5 rounded-[2rem] border border-zinc-800/40 flex items-center justify-between">
               <div className="flex items-center gap-4">
                  <div className={`w-12 h-12 rounded-2xl flex items-center justify-center text-xl ${CATEGORY_COLORS[t.category]}`}>
                    {Icons[t.category] ? React.createElement(Icons[t.category]) : '‚ú®'}
                  </div>
                  <div>
                    <p className="text-xs font-black uppercase text-zinc-200">{t.category}</p>
                    <p className="text-[10px] font-bold text-zinc-500 truncate max-w-[120px]">{t.note || 'No context'}</p>
                  </div>
               </div>
               <p className={`font-black italic ${t.type === 'Income' ? 'text-emerald-400' : 'text-white'}`}>
                 {t.type === 'Income' ? '+' : '-'}{formatCurrency(t.amount)}
               </p>
            </div>
          ))}
          {transactions.length === 0 && <div className="text-center py-20 text-zinc-700 font-black italic uppercase">The ledger is cold.</div>}
        </div>
      );

      const Cash = ({ cash, setCash }) => {
        const [v, setV] = React.useState('');
        return (
          <div className="space-y-6 animate-in fade-in duration-500">
            <div className="bg-zinc-900/50 rounded-[2.5rem] p-10 text-center border-2 border-emerald-500/10">
               <p className="text-zinc-500 text-[10px] font-black uppercase tracking-widest mb-2">Cash Assets</p>
               <h2 className="text-6xl font-black italic tracking-tighter text-emerald-400">{formatCurrency(cash.balance)}</h2>
            </div>
            <div className="p-8 bg-zinc-900/40 rounded-[2rem] border border-zinc-800/40">
               <input 
                type="number" value={v} onChange={e => setV(e.target.value)} placeholder="0.00" 
                className="w-full bg-black py-6 rounded-2xl text-4xl font-black italic text-center text-white outline-none border-2 border-zinc-800 focus:border-white transition-colors"
               />
               <div className="grid grid-cols-2 gap-3 mt-4">
                 <button onClick={() => { setCash({ balance: cash.balance + Number(v), lastUpdated: Date.now() }); setV(''); }} className="bg-white text-black py-5 rounded-2xl font-black uppercase text-xs active:scale-95 transition-all">Deposit</button>
                 <button onClick={() => { setCash({ balance: Number(v), lastUpdated: Date.now() }); setV(''); }} className="bg-zinc-800 text-zinc-400 py-5 rounded-2xl font-black uppercase text-xs active:scale-95 transition-all">Sync</button>
               </div>
            </div>
          </div>
        );
      };

      const AddModal = ({ onClose, onSubmit }) => {
        const [f, setF] = React.useState({ amount: '', type: 'Expense', category: 'Food', paymentMethod: 'Cash', note: '' });
        return (
          <div className="fixed inset-0 z-[100] flex items-end justify-center p-4 bg-black/80 backdrop-blur-2xl">
            <div className="bg-zinc-900 w-full max-w-lg rounded-[3rem] p-8 pb-[calc(2rem+var(--sab))] border border-zinc-800 animate-in slide-in-from-bottom duration-300">
              <div className="flex justify-between items-center mb-6">
                <h2 className="text-xl font-black italic uppercase tracking-tighter">New Entry</h2>
                <button onClick={onClose} className="p-2 text-zinc-500 text-2xl">‚úï</button>
              </div>
              <div className="flex bg-black p-1 rounded-2xl border border-zinc-800 mb-6">
                {['Income', 'Expense'].map(t => (
                  <button key={t} onClick={() => setF({...f, type: t, category: t === 'Income' ? 'Salary' : 'Food'})} className={`flex-1 py-4 rounded-xl font-black text-[10px] uppercase tracking-widest transition-all ${f.type === t ? 'bg-zinc-800 text-white' : 'text-zinc-600'}`}>{t}</button>
                ))}
              </div>
              <input 
                autoFocus type="number" placeholder="0.00" value={f.amount} onChange={e => setF({...f, amount: e.target.value})} 
                className="w-full bg-transparent py-8 text-7xl font-black italic text-center text-white outline-none placeholder:text-zinc-800" 
              />
              <div className="grid grid-cols-4 gap-2 mt-6">
                 {(f.type === 'Expense' ? ['Food', 'Transport', 'Bills', 'Fun'] : ['Salary', 'Side Hustle', 'Gift', 'Other']).map(c => (
                   <button key={c} onClick={() => setF({...f, category: c})} className={`p-4 rounded-2xl border-2 flex flex-col items-center gap-1 transition-all ${f.category === c ? 'bg-white border-white text-black' : 'bg-black border-zinc-900 text-zinc-600'}`}>
                     <span className="text-xl">{Icons[c] ? React.createElement(Icons[c]) : '‚ú®'}</span>
                     <span className="text-[8px] font-black uppercase truncate w-full text-center">{c}</span>
                   </button>
                 ))}
              </div>
              <button onClick={() => { if(f.amount) onSubmit({...f, amount: Number(f.amount)}); }} className="w-full bg-white text-black py-6 rounded-full font-black italic uppercase text-lg mt-8 active:scale-95 transition-all">Secure entry</button>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
