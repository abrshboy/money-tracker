
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>CLOUTKEEPER</title>
    
    <!-- PWA / iOS Optimization -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CloutKeeper">
    
    <!-- App Icon -->
    <link rel="apple-touch-icon" href="https://imagizer.imageshack.com/img923/6784/tX0q0M.png">
    
    <meta name="theme-color" content="#000000">
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').catch(err => console.log('SW reg failed:', err));
        });
      }
      const originalWarn = console.warn;
      console.warn = (...args) => {
        if (args[0] && typeof args[0] === 'string' && (args[0].includes('cdn.tailwindcss.com') || args[0].includes('in-browser Babel transformer'))) return;
        originalWarn(...args);
      };
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <style>
      :root {
        --sat: env(safe-area-inset-top);
        --sab: env(safe-area-inset-bottom);
      }
      body { 
        font-family: 'Inter', sans-serif; 
        margin: 0; 
        padding: 0; 
        background-color: #000000;
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
        user-select: none;
        overscroll-behavior-y: none;
        color: white;
      }
      .safe-top { padding-top: calc(var(--sat) + 1.5rem); }
      .safe-bottom { padding-bottom: calc(var(--sab) + 7rem); }
      .nav-safe-bottom { bottom: calc(var(--sab) + 1.5rem); }
      
      @supports (-webkit-touch-callout: none) {
        .min-h-ios { min-height: -webkit-fill-available; }
      }
      
      .pro-motion-transition {
        transition: transform 0.2s cubic-bezier(0.33, 1, 0.68, 1), opacity 0.2s ease;
      }
      ::-webkit-scrollbar { display: none; }
      
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
  </head>
  <body>
    <div id="root"></div>
    
    <script type="text/babel" data-presets="react,typescript" data-type="module">
      import React, { useState, useEffect, useMemo } from 'react';
      import ReactDOM from 'react-dom/client';
      
      const CATEGORIES = ['Food', 'Transport', 'Bills', 'Fun', 'Salary', 'Side Hustle', 'Gift', 'Other'];
      const CATEGORY_COLORS = {
        Food: 'bg-orange-500/10 text-orange-400 border-orange-500/20',
        Transport: 'bg-blue-500/10 text-blue-400 border-blue-500/20',
        Bills: 'bg-purple-500/10 text-purple-400 border-purple-500/20',
        Fun: 'bg-pink-500/10 text-pink-400 border-pink-500/20',
        Salary: 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20',
        'Side Hustle': 'bg-cyan-500/10 text-cyan-400 border-cyan-500/20',
        Gift: 'bg-yellow-500/10 text-yellow-400 border-yellow-500/20',
        Other: 'bg-slate-500/10 text-slate-400 border-slate-500/20',
      };

      const Icons = {
        Food: () => <span>üçï</span>,
        Transport: () => <span>üõπ</span>,
        Bills: () => <span>üí∏</span>,
        Fun: () => <span>üé°</span>,
        Salary: () => <span>üí∞</span>,
        'Side Hustle': () => <span>üöÄ</span>,
        Gift: () => <span>üéÅ</span>,
        Other: () => <span>‚ú®</span>,
        Plus: () => <svg className="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={3}><path d="M12 4v16m8-8H4" /></svg>
      };

      const formatCurrency = (n) => new Intl.NumberFormat('en-ET', { style: 'currency', currency: 'ETB' }).format(n).replace('ETB', 'Br');

      const App = () => {
        const [activeTab, setActiveTab] = useState('dashboard');
        const [isModalOpen, setIsModalOpen] = useState(false);
        const [transactions, setTransactions] = useState([]);
        const [cash, setCash] = useState({ balance: 0, lastUpdated: Date.now() });

        useEffect(() => {
          const t = localStorage.getItem('clout_txs');
          const c = localStorage.getItem('clout_cash');
          if (t) setTransactions(JSON.parse(t));
          if (c) setCash(JSON.parse(c));
        }, []);

        useEffect(() => {
          localStorage.setItem('clout_txs', JSON.stringify(transactions));
          localStorage.setItem('clout_cash', JSON.stringify(cash));
        }, [transactions, cash]);

        const onAddEntry = (data) => {
          const entry = { ...data, id: Date.now(), timestamp: Date.now() };
          setTransactions(prev => [entry, ...prev]);
          if (data.paymentMethod === 'Cash') {
            const mod = data.type === 'Income' ? 1 : -1;
            setCash(prev => ({ balance: prev.balance + (data.amount * mod), lastUpdated: Date.now() }));
          }
          setIsModalOpen(false);
        };

        const deleteTx = (id) => {
          const tx = transactions.find(t => t.id === id);
          if (tx && tx.paymentMethod === 'Cash') {
            const mod = tx.type === 'Income' ? -1 : 1;
            setCash(prev => ({ balance: prev.balance + (tx.amount * mod), lastUpdated: Date.now() }));
          }
          setTransactions(prev => prev.filter(t => t.id !== id));
        };

        return (
          <div className="min-h-ios bg-black flex flex-col items-center overflow-x-hidden">
            <header className="w-full max-w-xl px-6 safe-top flex items-center justify-between">
              <div className="flex items-center gap-3">
                 <img src="https://imagizer.imageshack.com/img923/6784/tX0q0M.png" className="w-9 h-9 rounded-lg border border-zinc-800" alt="Logo" />
                 <h1 className="text-xl font-black italic tracking-tighter text-white">CLOUT<span className="text-pink-500">KEEPER</span></h1>
              </div>
              <div className="bg-zinc-900/80 px-3 py-1 rounded-full border border-zinc-800">
                <span className="text-[9px] font-black uppercase tracking-widest text-zinc-500">PRO MAX</span>
              </div>
            </header>

            <main className="w-full max-w-xl px-6 flex-1 safe-bottom mt-6 space-y-6 overflow-y-auto">
              {activeTab === 'dashboard' && <Dashboard transactions={transactions} />}
              {activeTab === 'history' && <History transactions={transactions} onDelete={deleteTx} />}
              {activeTab === 'cash' && <Cash cash={cash} setCash={setCash} />}
            </main>

            <div className="fixed bottom-32 right-6 z-50">
              <button 
                onClick={() => setIsModalOpen(true)}
                className="w-16 h-16 bg-white text-black rounded-full shadow-[0_0_40px_rgba(255,255,255,0.25)] flex items-center justify-center active:scale-90 pro-motion-transition"
              >
                <Icons.Plus />
              </button>
            </div>

            <nav className="fixed nav-safe-bottom left-1/2 -translate-x-1/2 w-[90%] max-w-md bg-zinc-900/70 backdrop-blur-3xl border border-white/10 rounded-full z-40 px-10 py-5 flex items-center justify-between shadow-2xl">
              <NavBtn active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} icon="üè†" label="Flow" />
              <NavBtn active={activeTab === 'history'} onClick={() => setActiveTab('history')} icon="üßæ" label="Feed" />
              <NavBtn active={activeTab === 'cash'} onClick={() => setActiveTab('cash')} icon="üí∞" label="Vault" />
            </nav>

            {isModalOpen && <AddModal onClose={() => setIsModalOpen(false)} onSubmit={onAddEntry} />}
          </div>
        );
      };

      const NavBtn = ({ active, onClick, icon, label }) => (
        <button onClick={onClick} className={`flex flex-col items-center gap-1.5 transition-all ${active ? 'text-white scale-110' : 'text-zinc-500'}`}>
          <span className="text-xl">{icon}</span>
          <span className="text-[9px] font-black uppercase tracking-[0.2em]">{label}</span>
        </button>
      );

      const Dashboard = ({ transactions }) => {
        const out = useMemo(() => transactions.filter(t => t.type === 'Expense').reduce((s, t) => s + t.amount, 0), [transactions]);
        const inc = useMemo(() => transactions.filter(t => t.type === 'Income').reduce((s, t) => s + t.amount, 0), [transactions]);
        
        const breakdown = useMemo(() => {
          const cats = {};
          transactions.filter(t => t.type === 'Expense').forEach(t => {
            cats[t.category] = (cats[t.category] || 0) + t.amount;
          });
          return Object.entries(cats).sort((a,b) => b[1] - a[1]);
        }, [transactions]);

        return (
          <div className="animate-in fade-in slide-in-from-bottom-4 duration-500 space-y-6">
            <div className="bg-zinc-900/40 rounded-[2.5rem] p-8 border border-white/5 relative overflow-hidden backdrop-blur-sm">
              <span className="text-zinc-500 text-[10px] font-black uppercase tracking-[0.4em]">Current Flow</span>
              <h2 className="text-4xl font-black italic tracking-tighter mt-2 text-white">{formatCurrency(inc - out)}</h2>
              <div className="mt-8 grid grid-cols-2 gap-6 border-t border-white/5 pt-6">
                <div>
                   <p className="text-zinc-500 text-[9px] font-black uppercase tracking-widest mb-1 text-center">Inflow</p>
                   <p className="text-emerald-400 font-black text-center text-lg">{formatCurrency(inc)}</p>
                </div>
                <div>
                   <p className="text-zinc-500 text-[9px] font-black uppercase tracking-widest mb-1 text-center">Outflow</p>
                   <p className="text-pink-500 font-black text-center text-lg">{formatCurrency(out)}</p>
                </div>
              </div>
            </div>

            <div className="bg-zinc-950 p-6 rounded-3xl border border-zinc-900">
               <h3 className="text-[10px] font-black uppercase tracking-widest text-zinc-500 mb-6 text-center">Burning Clout By Category</h3>
               <div className="space-y-5">
                 {breakdown.map(([cat, amount]) => (
                   <div key={cat} className="space-y-2">
                     <div className="flex justify-between items-end">
                       <span className="text-xs font-black uppercase text-zinc-300">{cat}</span>
                       <span className="text-xs font-bold text-zinc-500 italic">{formatCurrency(amount)}</span>
                     </div>
                     <div className="h-1.5 w-full bg-zinc-900 rounded-full overflow-hidden">
                       <div 
                        className={`h-full rounded-full ${CATEGORY_COLORS[cat].split(' ')[0].replace('/10', '')}`} 
                        style={{ width: `${(amount / (out || 1)) * 100}%` }}
                       />
                     </div>
                   </div>
                 ))}
                 {breakdown.length === 0 && <p className="text-center py-6 text-zinc-700 font-black italic uppercase text-[10px] tracking-widest">No burns detected</p>}
               </div>
            </div>
          </div>
        );
      };

      const History = ({ transactions, onDelete }) => {
        const [month, setMonth] = useState(new Date().getMonth());
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        
        const filtered = transactions.filter(t => new Date(t.timestamp).getMonth() === month);

        return (
          <div className="space-y-4 animate-in fade-in duration-500 pb-10">
            <div className="flex items-center justify-between mb-2">
              <h2 className="text-lg font-black italic uppercase tracking-tighter">The Ledger</h2>
              <select 
                value={month} 
                onChange={e => setMonth(Number(e.target.value))}
                className="bg-zinc-900 text-zinc-300 text-[10px] font-black uppercase px-3 py-1.5 rounded-lg border border-white/5 outline-none"
              >
                {months.map((m, i) => <option key={m} value={i}>{m}</option>)}
              </select>
            </div>
            {filtered.map(t => (
              <div key={t.id} className="bg-zinc-900/30 p-4 rounded-3xl border border-white/5 flex items-center justify-between group active:scale-95 transition-all">
                 <div className="flex items-center gap-4">
                    <div className={`w-10 h-10 rounded-xl flex items-center justify-center text-lg ${CATEGORY_COLORS[t.category]}`}>
                      {Icons[t.category] ? React.createElement(Icons[t.category]) : '‚ú®'}
                    </div>
                    <div>
                      <p className="text-[10px] font-black uppercase text-zinc-200">{t.category}</p>
                      <p className="text-[10px] font-bold text-zinc-500 truncate max-w-[100px]">{t.note || 'No Context'}</p>
                    </div>
                 </div>
                 <div className="text-right flex flex-col items-end gap-1">
                    <p className={`font-black italic text-sm ${t.type === 'Income' ? 'text-emerald-400' : 'text-white'}`}>
                      {t.type === 'Income' ? '+' : '-'}{formatCurrency(t.amount)}
                    </p>
                    <span className="text-[8px] font-black uppercase text-zinc-600 tracking-tighter">{t.paymentMethod}</span>
                 </div>
                 <button onClick={() => onDelete(t.id)} className="ml-2 hidden group-hover:block p-1 text-zinc-600 hover:text-pink-500">‚úï</button>
              </div>
            ))}
            {filtered.length === 0 && <div className="text-center py-20 text-zinc-800 font-black italic uppercase text-xs">Ledger is cold for this period.</div>}
          </div>
        );
      };

      const Cash = ({ cash, setCash }) => {
        const [v, setV] = React.useState('');
        return (
          <div className="space-y-6 animate-in fade-in duration-500">
            <div className="bg-zinc-900/50 rounded-[2.5rem] p-10 text-center border-2 border-emerald-500/10 backdrop-blur-sm">
               <p className="text-zinc-500 text-[10px] font-black uppercase tracking-[0.3em] mb-2">Vault Balance</p>
               <h2 className="text-5xl font-black italic tracking-tighter text-emerald-400">{formatCurrency(cash.balance)}</h2>
            </div>
            <div className="p-8 bg-zinc-900/30 rounded-[2rem] border border-white/5">
               <input 
                type="number" value={v} onChange={e => setV(e.target.value)} placeholder="0.00" 
                className="w-full bg-black/50 py-5 rounded-2xl text-3xl font-black italic text-center text-white outline-none border-2 border-zinc-800 focus:border-emerald-500/50 transition-all"
               />
               <div className="grid grid-cols-2 gap-3 mt-4">
                 <button onClick={() => { if(v) { setCash({ balance: cash.balance + Number(v), lastUpdated: Date.now() }); setV(''); } }} className="bg-white text-black py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest active:scale-95 transition-all shadow-xl">Deposit</button>
                 <button onClick={() => { if(v) { setCash({ balance: Number(v), lastUpdated: Date.now() }); setV(''); } }} className="bg-zinc-800 text-zinc-400 py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest active:scale-95 transition-all border border-white/5">Reconcile</button>
               </div>
            </div>
          </div>
        );
      };

      const AddModal = ({ onClose, onSubmit }) => {
        const [f, setF] = React.useState({ amount: '', type: 'Expense', category: 'Food', paymentMethod: 'Cash', note: '' });
        return (
          <div className="fixed inset-0 z-[100] flex items-end justify-center p-4 bg-black/85 backdrop-blur-xl">
            <div className="bg-zinc-900 w-full max-w-lg rounded-[3rem] p-8 pb-[calc(2.5rem+var(--sab))] border border-white/10 animate-in slide-in-from-bottom duration-300">
              <div className="flex justify-between items-center mb-6">
                <h2 className="text-lg font-black italic uppercase tracking-tighter">New Clout</h2>
                <button onClick={onClose} className="p-2 text-zinc-500 text-xl font-bold">‚úï</button>
              </div>
              <div className="flex bg-black p-1 rounded-2xl border border-zinc-800 mb-6 shadow-inner">
                {['Income', 'Expense'].map(t => (
                  <button key={t} onClick={() => setF({...f, type: t, category: t === 'Income' ? 'Salary' : 'Food'})} className={`flex-1 py-3 rounded-xl font-black text-[9px] uppercase tracking-widest transition-all ${f.type === t ? 'bg-zinc-800 text-white shadow-lg' : 'text-zinc-600'}`}>{t}</button>
                ))}
              </div>
              <div className="relative mb-6">
                <span className="absolute left-6 top-1/2 -translate-y-1/2 text-2xl font-black text-zinc-800 italic">Br</span>
                <input 
                  autoFocus type="number" placeholder="0.00" value={f.amount} onChange={e => setF({...f, amount: e.target.value})} 
                  className="w-full bg-transparent py-6 pl-16 text-5xl font-black italic text-center text-white outline-none placeholder:text-zinc-800" 
                />
              </div>
              <div className="grid grid-cols-4 gap-2 mt-4">
                 {(f.type === 'Expense' ? ['Food', 'Transport', 'Bills', 'Fun'] : ['Salary', 'Side Hustle', 'Gift', 'Other']).map(c => (
                   <button key={c} onClick={() => setF({...f, category: c})} className={`p-4 rounded-2xl border-2 flex flex-col items-center gap-1.5 transition-all ${f.category === c ? 'bg-white border-white text-black' : 'bg-zinc-950 border-zinc-900 text-zinc-700'}`}>
                     <span className="text-xl">{Icons[c] ? React.createElement(Icons[c]) : '‚ú®'}</span>
                     <span className="text-[7px] font-black uppercase truncate w-full text-center">{c}</span>
                   </button>
                 ))}
              </div>
              <div className="grid grid-cols-2 gap-3 mt-6">
                 <select value={f.paymentMethod} onChange={e => setF({...f, paymentMethod: e.target.value})} className="bg-zinc-950 text-zinc-400 p-4 rounded-2xl font-black uppercase text-[9px] border-zinc-800 border outline-none">
                    <option value="Cash">Physical Cash</option>
                    <option value="Non-cash">Digital/Bank</option>
                 </select>
                 <input value={f.note} onChange={e => setF({...f, note: e.target.value})} placeholder="Vibe Check..." className="bg-zinc-950 text-zinc-400 p-4 rounded-2xl font-black uppercase text-[9px] border-zinc-800 border outline-none placeholder:text-zinc-800" />
              </div>
              <button onClick={() => { if(f.amount) onSubmit({...f, amount: Number(f.amount)}); }} className="w-full bg-white text-black py-5 rounded-full font-black italic uppercase text-lg mt-8 active:scale-95 transition-all shadow-[0_10px_30px_rgba(255,255,255,0.2)]">Secure the Clout</button>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
