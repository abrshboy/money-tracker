
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>CLOUTKEEPER</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CloutKeeper">
    <link rel="apple-touch-icon" href="https://imagizer.imageshack.com/img923/6784/tX0q0M.png">
    <meta name="theme-color" content="#000000">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').catch(err => console.log('SW reg failed:', err));
        });
      }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <style>
      :root {
        --sat: env(safe-area-inset-top);
        --sab: env(safe-area-inset-bottom);
      }
      body { 
        font-family: 'Inter', sans-serif; 
        margin: 0; 
        padding: 0; 
        background-color: #000000;
        -webkit-tap-highlight-color: transparent;
        user-select: none;
        overscroll-behavior-y: none;
        color: white;
      }
      .safe-top { padding-top: calc(var(--sat) + 1.5rem); }
      .safe-bottom { padding-bottom: calc(var(--sab) + 7rem); }
      .nav-safe-bottom { bottom: calc(var(--sab) + 1.5rem); }
      .min-h-ios { min-height: 100vh; min-height: -webkit-fill-available; }
      .pro-transition { transition: all 0.2s cubic-bezier(0.33, 1, 0.68, 1); }
      ::-webkit-scrollbar { display: none; }
      input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
  </head>
  <body>
    <div id="root"></div>
    
    <script type="text/babel" data-presets="react,typescript" data-type="module">
      import React, { useState, useEffect, useMemo } from 'react';
      import ReactDOM from 'react-dom/client';

      const SVGIcon = ({ name, className = "w-6 h-6" }) => {
        const icons = {
          Food: <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />,
          Transport: <path d="M5 18l-2 2h18l-2-2M7 10a2 2 0 110-4 2 2 0 010 4zm10 0a2 2 0 110-4 2 2 0 010 4zM4 16h16V8H4v8z" />,
          Bills: <path d="M20 12V8H4v4m16 0c0 1-1 2-2 2H6c-1 0-2-1-2-2m16 0v4a2 2 0 01-2 2H6a2 2 0 01-2-2v-4" />,
          Fun: <path d="M12 8a3 3 0 100-6 3 3 0 000 6zm0 0v11m-4-7l4 4 4-4" />,
          Salary: <path d="M12 1v22M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6" />,
          SideHustle: <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />,
          Gift: <path d="M20 12v10H4V12M2 7h20v5H2V7zm10 0V2m0 5c-1-2-4-2-4 0s3 2 4 4c1-2 4-2 4 0s-3 2-4 0z" />,
          Shopping: <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4H6zM3 6h18M16 10a4 4 0 01-8 0" />,
          Health: <path d="M22 12h-4l-3 9L9 3l-3 9H2" />,
          Education: <path d="M12 19l7-7 3 3-7 7-3-3zM12 19l-7-7-3 3 7 7 3-3zM2 4l10-2 10 2v6l-10 2L2 10V4z" />,
          Investment: <path d="M23 6l-9.5 9.5-5-5L1 18m22-12h-6m6 0v6" />,
          Rent: <path d="M3 21h18M3 10l9-7 9 7v11H3V10zm6 4v3m6-3v3" />,
          Other: <path d="M12 5v14M5 12h14" />,
          CloutLogo: <path d="M12 2L2 12l10 10 10-10L12 2zm0 4l6 6-6 6-6-6 6-6z" fill="currentColor"/>
        };
        return <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" className={className}>{icons[name] || icons.Other}</svg>;
      };

      const EXPENSE_CATS = [
        { id: 'Food', color: 'text-orange-400' },
        { id: 'Transport', color: 'text-blue-400' },
        { id: 'Bills', color: 'text-purple-400' },
        { id: 'Shopping', color: 'text-pink-400' },
        { id: 'Health', color: 'text-red-400' },
        { id: 'Rent', color: 'text-indigo-400' },
        { id: 'Fun', color: 'text-yellow-400' },
        { id: 'Other', color: 'text-zinc-400' }
      ];

      const INCOME_CATS = [
        { id: 'Salary', color: 'text-emerald-400' },
        { id: 'SideHustle', color: 'text-cyan-400' },
        { id: 'Gift', color: 'text-amber-400' },
        { id: 'Investment', color: 'text-blue-400' },
        { id: 'Other', color: 'text-zinc-400' }
      ];

      const formatCurrency = (n) => new Intl.NumberFormat('en-ET', { style: 'currency', currency: 'ETB' }).format(n).replace('ETB', 'Br');

      const App = () => {
        const [activeTab, setActiveTab] = useState('dashboard');
        const [isModalOpen, setIsModalOpen] = useState(false);
        const [transactions, setTransactions] = useState([]);
        const [cash, setCash] = useState({ balance: 0, lastUpdated: Date.now() });

        useEffect(() => {
          const t = localStorage.getItem('clout_txs');
          const c = localStorage.getItem('clout_cash');
          if (t) setTransactions(JSON.parse(t));
          if (c) setCash(JSON.parse(c));
        }, []);

        useEffect(() => {
          localStorage.setItem('clout_txs', JSON.stringify(transactions));
          localStorage.setItem('clout_cash', JSON.stringify(cash));
        }, [transactions, cash]);

        const onAddEntry = (data) => {
          const entry = { ...data, id: Date.now(), timestamp: Date.now() };
          setTransactions(prev => [entry, ...prev]);
          if (data.paymentMethod === 'Cash') {
            setCash(prev => ({ balance: prev.balance + (data.amount * (data.type === 'Income' ? 1 : -1)), lastUpdated: Date.now() }));
          }
          setIsModalOpen(false);
        };

        return (
          <div className="min-h-ios bg-black flex flex-col items-center">
            <header className="w-full max-w-xl px-6 safe-top flex items-center justify-between">
              <div className="flex items-center gap-2">
                <div className="p-1.5 bg-zinc-900 rounded-lg text-pink-500 shadow-lg shadow-pink-500/10">
                  <SVGIcon name="CloutLogo" className="w-6 h-6" />
                </div>
                <h1 className="text-lg font-black italic tracking-tighter text-white">CLOUT<span className="text-zinc-500">KEEPER</span></h1>
              </div>
              <div className="bg-zinc-900/80 px-3 py-1 rounded-full border border-white/5">
                <span className="text-[9px] font-black uppercase tracking-widest text-zinc-500">ENGINE v2</span>
              </div>
            </header>

            <main className="w-full max-w-xl px-6 flex-1 safe-bottom mt-6 space-y-6 overflow-y-auto pb-10">
              {activeTab === 'dashboard' && <Dashboard transactions={transactions} />}
              {activeTab === 'history' && <History transactions={transactions} />}
              {activeTab === 'cash' && <CashView cash={cash} setCash={setCash} />}
            </main>

            <div className="fixed bottom-32 right-6 z-50">
              <button onClick={() => setIsModalOpen(true)} className="w-14 h-14 bg-white text-black rounded-full shadow-2xl flex items-center justify-center active:scale-90 pro-transition">
                <svg className="w-7 h-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={3}><path d="M12 4v16m8-8H4" /></svg>
              </button>
            </div>

            <nav className="fixed nav-safe-bottom left-1/2 -translate-x-1/2 w-[90%] max-w-md bg-zinc-900/80 backdrop-blur-2xl border border-white/5 rounded-full z-40 px-8 py-4 flex items-center justify-between shadow-2xl">
              <NavBtn active={activeTab === 'dashboard'} onClick={() => setActiveTab('dashboard')} icon={<path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />} label="FLOW" />
              <NavBtn active={activeTab === 'history'} onClick={() => setActiveTab('history')} icon={<path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />} label="FEED" />
              <NavBtn active={activeTab === 'cash'} onClick={() => setActiveTab('cash')} icon={<path d="M12 1v22M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6" />} label="VAULT" />
            </nav>

            {isModalOpen && <AddModal onClose={() => setIsModalOpen(false)} onSubmit={onAddEntry} />}
          </div>
        );
      };

      const NavBtn = ({ active, onClick, icon, label }) => (
        <button onClick={onClick} className={`flex flex-col items-center gap-1 pro-transition ${active ? 'text-white' : 'text-zinc-600'}`}>
          <svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">{icon}</svg>
          <span className="text-[8px] font-black uppercase tracking-widest">{label}</span>
        </button>
      );

      const Dashboard = ({ transactions }) => {
        const out = useMemo(() => transactions.filter(t => t.type === 'Expense').reduce((s, t) => s + t.amount, 0), [transactions]);
        const inc = useMemo(() => transactions.filter(t => t.type === 'Income').reduce((s, t) => s + t.amount, 0), [transactions]);
        const breakdown = useMemo(() => {
          const cats = {};
          transactions.filter(t => t.type === 'Expense').forEach(t => cats[t.category] = (cats[t.category] || 0) + t.amount);
          return Object.entries(cats).sort((a,b) => b[1] - a[1]).slice(0, 4);
        }, [transactions]);

        return (
          <div className="space-y-6 animate-in fade-in duration-500">
            <div className="bg-zinc-900/40 rounded-3xl p-7 border border-white/5">
              <p className="text-zinc-500 text-[9px] font-black uppercase tracking-[0.3em] mb-1">Portfolio Balance</p>
              <h2 className="text-3xl font-black italic text-white mb-6 tracking-tighter">{formatCurrency(inc - out)}</h2>
              <div className="grid grid-cols-2 gap-4 border-t border-white/5 pt-5">
                <div><p className="text-zinc-600 text-[8px] font-black uppercase">Inflow</p><p className="text-emerald-400 font-bold text-sm">{formatCurrency(inc)}</p></div>
                <div><p className="text-zinc-600 text-[8px] font-black uppercase">Outflow</p><p className="text-pink-500 font-bold text-sm">{formatCurrency(out)}</p></div>
              </div>
            </div>

            <div className="bg-zinc-950 p-6 rounded-3xl border border-zinc-900">
              <h3 className="text-[9px] font-black uppercase tracking-widest text-zinc-600 mb-5">Expense Pulse</h3>
              <div className="space-y-4">
                {breakdown.map(([cat, amount]) => (
                  <div key={cat} className="flex items-center justify-between group">
                    <div className="flex items-center gap-3">
                      <div className={`p-2 rounded-lg bg-zinc-900 border border-white/5 ${EXPENSE_CATS.find(c => c.id === cat)?.color || 'text-zinc-400'}`}>
                        <SVGIcon name={cat} className="w-4 h-4" />
                      </div>
                      <span className="text-[11px] font-black uppercase text-zinc-300">{cat}</span>
                    </div>
                    <span className="text-[11px] font-bold text-zinc-500">{formatCurrency(amount)}</span>
                  </div>
                ))}
                {breakdown.length === 0 && <p className="text-center py-4 text-zinc-800 text-[9px] font-black uppercase tracking-widest italic">No data logged</p>}
              </div>
            </div>
          </div>
        );
      };

      const History = ({ transactions }) => (
        <div className="space-y-3 pb-20 animate-in fade-in duration-500">
          <h2 className="text-[10px] font-black uppercase tracking-widest text-zinc-500 px-1">Recent Feed</h2>
          {transactions.slice(0, 20).map(t => (
            <div key={t.id} className="bg-zinc-900/30 p-4 rounded-2xl border border-white/5 flex items-center justify-between">
              <div className="flex items-center gap-4">
                <div className={`p-2.5 rounded-xl bg-zinc-950 border border-white/5 ${t.type === 'Income' ? INCOME_CATS.find(c => c.id === t.category)?.color : EXPENSE_CATS.find(c => c.id === t.category)?.color}`}>
                  <SVGIcon name={t.category} className="w-4 h-4" />
                </div>
                <div>
                  <p className="text-[10px] font-black uppercase text-zinc-200">{t.category}</p>
                  <p className="text-[9px] font-bold text-zinc-600 truncate max-w-[120px] tracking-tight">{t.note || 'No metadata'}</p>
                </div>
              </div>
              <p className={`text-xs font-black italic ${t.type === 'Income' ? 'text-emerald-400' : 'text-white'}`}>
                {t.type === 'Income' ? '+' : '-'}{formatCurrency(t.amount)}
              </p>
            </div>
          ))}
        </div>
      );

      const CashView = ({ cash, setCash }) => {
        const [v, setV] = useState('');
        return (
          <div className="space-y-6 animate-in fade-in duration-500">
            <div className="bg-zinc-900/40 rounded-[2.5rem] p-10 text-center border border-white/5">
              <p className="text-zinc-500 text-[9px] font-black uppercase tracking-widest mb-2">Vaulted Physical Cash</p>
              <h2 className="text-4xl font-black italic tracking-tighter text-emerald-400">{formatCurrency(cash.balance)}</h2>
            </div>
            <div className="p-8 bg-zinc-900/30 rounded-3xl border border-white/5">
              <input type="number" value={v} onChange={e => setV(e.target.value)} placeholder="0.00" className="w-full bg-black py-4 rounded-xl text-2xl font-black italic text-center text-white outline-none border border-zinc-800 focus:border-white pro-transition" />
              <div className="grid grid-cols-2 gap-3 mt-4">
                <button onClick={() => { if(v) { setCash({ ...cash, balance: cash.balance + Number(v) }); setV(''); } }} className="bg-white text-black py-4 rounded-xl font-black uppercase text-[10px] tracking-widest active:scale-95 pro-transition">Deposit</button>
                <button onClick={() => { if(v) { setCash({ ...cash, balance: Number(v) }); setV(''); } }} className="bg-zinc-800 text-zinc-400 py-4 rounded-xl font-black uppercase text-[10px] tracking-widest active:scale-95 pro-transition">Sync</button>
              </div>
            </div>
          </div>
        );
      };

      const AddModal = ({ onClose, onSubmit }) => {
        const [f, setF] = useState({ amount: '', type: 'Expense', category: 'Food', paymentMethod: 'Cash', note: '' });
        const categories = f.type === 'Expense' ? EXPENSE_CATS : INCOME_CATS;
        
        return (
          <div className="fixed inset-0 z-[100] flex items-end justify-center p-4 bg-black/80 backdrop-blur-xl">
            <div className="bg-zinc-900 w-full max-w-lg rounded-[2.5rem] p-6 pb-[calc(2.5rem+var(--sab))] border border-white/5 animate-in slide-in-from-bottom duration-300">
              <div className="flex justify-between items-center mb-6 px-2">
                <h2 className="text-[10px] font-black uppercase tracking-[0.2em] text-zinc-500">NEW ENTRY</h2>
                <button onClick={onClose} className="text-zinc-600">âœ•</button>
              </div>
              <div className="flex bg-black p-1 rounded-xl mb-6">
                {['Income', 'Expense'].map(t => (
                  <button key={t} onClick={() => setF({...f, type: t, category: t === 'Income' ? 'Salary' : 'Food'})} className={`flex-1 py-3 rounded-lg font-black text-[9px] uppercase tracking-widest transition-all ${f.type === t ? 'bg-zinc-800 text-white' : 'text-zinc-600'}`}>{t}</button>
                ))}
              </div>
              <input autoFocus type="number" placeholder="0.00" value={f.amount} onChange={e => setF({...f, amount: e.target.value})} className="w-full bg-transparent py-4 text-5xl font-black italic text-center text-white outline-none placeholder:text-zinc-800" />
              <div className="grid grid-cols-4 gap-2 mt-6">
                {categories.map(c => (
                  <button key={c.id} onClick={() => setF({...f, category: c.id})} className={`p-3 rounded-xl border-2 pro-transition flex flex-col items-center gap-2 ${f.category === c.id ? 'bg-white border-white text-black' : 'bg-black border-zinc-900 text-zinc-700'}`}>
                    <SVGIcon name={c.id} className="w-5 h-5" />
                    <span className="text-[7px] font-black uppercase truncate w-full text-center tracking-tight">{c.id}</span>
                  </button>
                ))}
              </div>
              <div className="grid grid-cols-2 gap-3 mt-6">
                 <select value={f.paymentMethod} onChange={e => setF({...f, paymentMethod: e.target.value})} className="bg-black text-zinc-400 p-3 rounded-xl font-black uppercase text-[8px] border-zinc-800 outline-none">
                    <option value="Cash">Physical Cash</option>
                    <option value="Non-cash">Digital/Bank</option>
                 </select>
                 <input value={f.note} onChange={e => setF({...f, note: e.target.value})} placeholder="Context..." className="bg-black text-zinc-400 p-3 rounded-xl font-black uppercase text-[8px] border-zinc-800 outline-none" />
              </div>
              <button onClick={() => { if(f.amount) onSubmit({...f, amount: Number(f.amount)}); }} className="w-full bg-white text-black py-4 rounded-full font-black italic uppercase text-sm mt-8 active:scale-95 pro-transition shadow-xl">AUTHENTICATE ENTRY</button>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
